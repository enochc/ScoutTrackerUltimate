{%extends 'page_template.html'%}

{%block head%}
<style>
table{

}
.stripe{
    background-color:#d4eacc;
}
div.rank_header{
    float:left;
    width:14%;
    height:136px;
    text-align:center;
    padding:5px 0;
    
}
div.rank_header img{
    display:block;
    width:100px;
    margin:0 auto;
    cursor:pointer;
}
div.scout_name{
    width:100%;
    text-align:right;
    height:24px;
}
.current_rank{
    background-color:#efeacc;
    box-shadow: 5px 5px 3px #32523b;
    position:relative;
    z-index:0;
    border-top-left-radius:5px;
    border-top-right-radius:5px;
}
div#requirements{
    width:902px;
    padding:10px;
    background-color:#efeacc;
    box-shadow: 5px 5px 3px #32523b;
    position:relative;
    z-index:1;
    border-bottom-left-radius:5px;
    border-bottom-right-radius:5px;
    border-top-right-radius:5px;
}
div#requirements .req_header{
    float:left;
    height:20px;
    padding:5px 0;
    cursor:pointer;
}
div#requirements .req{
    width:60px;
    text-align:center;
    float:left;

    height:24px;
}
div#requirements .req.checkbox{
    cursor:pointer;
    
    font-size:xx-large;
}
div#requirements .req.checkbox:hover{
    font-weight:bold;
    
}
div.current_req{
    background-color:#d3cfb6;
}
div.current_req.stripe{
    background-color:#c3d6bc;
}
div#requirement_info{
    margin-top:30px;
    
}
#set_req_form{
    background-color:#005e9c;
    padding:10px;
    display:none;
    position:absolute;
    z-index:3;
    box-shadow: 5px 5px 3px #32523b;
    text-align:left;
    border-radius:5px;
    color:#fff;
}
#set_req_form textarea{
    width:240px;
    height:70px;
    margin:5px 0;
}
#set_req_form .button{
    float:left;
    width:80px;
}
</style>

<script>
var rank = 1
var req = 1

$(function(){
	get_rank(rank)
	
	$("img.rank_head").click(function(){
		rank = this.id.split('rank_head_')[1]
		get_rank(rank)
	})

})
function set_scout_requiremnt(r, s, b){
	api = '/requirement/set/'+req+'/'+scout+'/'
	$.post(api,function(data){
        doSuccess(data, function(){
        	b.html("<img src='{{MEDIA_URL}}check.png'/>")
        	$('#set_req_form').hide()
        })
    })
}
function post_load(){
	req = $("div.req_header")[0].id.split('r_')[1]
	get_req(req)
	$("div.req_header").click(function(){
        req = this.id.split('r_')[1]
        get_req(req)
    })
    $('.req.checkbox').click(function(){
    	var box = $(this)
    	req = box.attr('class').split('r_')[1].split(' ')[0]
    	get_req(req)
    	scout = box.attr('class').split('s_')[1].split(' ')[0]
    	
    	$('#set_req_form').load('/requirement/set/'+req+'/'+scout+'/',function(data){
    		$('#set_req_form').css({
    			'top':box.offset().top,
    			'left':box.offset().left
    		}).find('.cancel').click(function(){
    			$('#set_req_form').hide()
    		}).end().find('.send').click(function(){
    			set_scout_requiremnt(req, scout, box)
    		}).end().show()
    	})
    })
    $('div#requirements').unblock()
}
function get_rank(rid){
	$('#set_req_form').hide()
	$('div#requirements').block()
	$(".current_rank").removeClass("current_rank")
	$("#rank_head_"+rid).parent('div').addClass('current_rank')
	$('div#requirements').load('/requirement/rank_requirements/'+rid+"/", post_load)
	
}
function get_req(rid){
	$('.current_req').removeClass('current_req')
    $('div.req.r_'+req).addClass('current_req')
    $('div#r_'+req).addClass('current_req')
    $('#requirement_info').load("/requirement/info/"+req+"/")
}
</script>
{%endblock%}

{%block content%}
<table width="100%" border="1">
    <tr width="100%">
        <td></td>
        <td>
            
            {%for r in ranks%}
            <div class="rank_header">
                <img class="rank_head" id="rank_head_{{r.id}}" src='{{MEDIA_URL}}{{r.patch}}' title="click to view requirements for {{r}}"/>
                {{r.name}}
            </div>
            {%endfor%}
            
        </td>
    </tr>
    <tr>
        <td valign="top" style="padding-top:46px;padding-right:10px;">
        {%for scout in troop.scouts%}              
            <div class="scout_name" id='scout_{{scout.pk}}'><a href="/user/{{scout.pk}}/">{{scout}}</a>:</div>
        {%endfor%}   
        </td>
        <td valign="top">
            <div id='requirements'>
            &nbsp;
            </div>
        </td>
    </tr>


</table>
<div id="requirement_info">

</div>  

           
<div id="set_req_form">


</div>    
   
    
{%endblock%}